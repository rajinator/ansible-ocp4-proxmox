# OpenShift {{ openshift.cluster.name }} DHCP Configuration
# Generated by Ansible

{% set subnet = openshift.networking.machineCIDR.split('/')[0] %}
{% set octets = subnet.split('.') %}
{% set subnet_base = octets[0] + '.' + octets[1] + '.' + octets[2] + '.0' %}

subnet {{ subnet_base }} netmask {{ vmNet.dhcpRangeMask }} {
    option routers {{ vmNet.router }};
    option domain-name "{{ openshift.cluster.name }}.{{ openshift.cluster.baseDomain }}";
    option domain-name-servers {{ ansible_default_ipv4.address }};
    option domain-search "{{ openshift.cluster.name }}.{{ openshift.cluster.baseDomain }}", "{{ openshift.cluster.baseDomain }}";
    option ntp-servers {{ ansible_default_ipv4.address }};
    
    default-lease-time 86400;      # 24 hours
    max-lease-time 172800;         # 48 hours
    
    # Security: Only allow known MAC addresses
    deny unknown-clients;

    # Bootstrap node - Temporary for cluster installation
{% for node in nodeNetworkInfo.bootstrap %}
    host {{ node.name }} {
        hardware ethernet {{ node.MAC }};
        fixed-address {{ node.IP }};
        option host-name "{{ node.name }}.{{ openshift.cluster.name }}.{{ openshift.cluster.baseDomain }}";
    }
{% endfor %}

    # Control plane nodes (Masters)
{% for node in nodeNetworkInfo.controlplanes %}
    host {{ node.name }} {
        hardware ethernet {{ node.MAC }};
        fixed-address {{ node.IP }};
        option host-name "{{ node.name }}.{{ openshift.cluster.name }}.{{ openshift.cluster.baseDomain }}";
    }
{% endfor %}

{% if nodeNetworkInfo.computes is defined and nodeNetworkInfo.computes | length > 0 %}
    # Compute nodes (Workers)
{% for node in nodeNetworkInfo.computes %}
    host {{ node.name }} {
        hardware ethernet {{ node.MAC }};
        fixed-address {{ node.IP }};
        option host-name "{{ node.name }}.{{ openshift.cluster.name }}.{{ openshift.cluster.baseDomain }}";
    }
{% endfor %}
{% endif %}
}

